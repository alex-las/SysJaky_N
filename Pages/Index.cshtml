@page
@model IndexModel
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer
@{
    ViewData["Title"] = Localizer["Title"];
}

<section class="py-5 gradient-hero text-white text-center rounded-4 mb-4 hero-section">
    <div class="hero-background" aria-hidden="true">
        <span class="hero-floating-icon hero-icon-1">ISO<br />9001</span>
        <span class="hero-floating-icon hero-icon-2">ISO<br />14001</span>
        <span class="hero-floating-icon hero-icon-3">ISO<br />45001</span>
        <span class="hero-floating-icon hero-icon-4">ISO<br />27001</span>
    </div>
    <div class="container-xl position-relative">
        <h1 class="display-5 fw-bold mb-2">@Localizer["HeroHeadingPrefix"] <span class="underline-accent"><span class="typewriter" data-typewriter-text="@Localizer["HeroHeadingAccent"]">@Localizer["HeroHeadingAccent"]</span></span></h1>
        <p class="lead mb-4 opacity-75">@Localizer["HeroSubheading"]</p>

        <form method="get" action="/Courses/Index" class="row g-2 justify-content-center" id="heroForm">
            <div class="col-12 col-md-3">
                <select name="persona" class="form-select filter-select" aria-label="@Localizer["PersonaAriaLabel"]" persona-options></select>
            </div>
            <div class="col-12 col-md-3">
                <select name="goal" class="form-select filter-select" aria-label="@Localizer["GoalAriaLabel"]" goal-options></select>
            </div>
            <div class="col-12 col-md-4">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input name="q" class="form-control" placeholder="@Localizer["HeroSearchPlaceholder"]" />
                </div>
            </div>
            <div class="col-12 col-md-2 d-grid">
                <button class="btn btn-light fw-semibold" type="submit">@Localizer["HeroSubmit"]</button>
            </div>
        </form>

        <div class="d-flex flex-wrap gap-2 justify-content-center mt-3">
            <a class="chip chip-light" href="/Courses/Index?Mode=Online">@Localizer["ChipOnline"]</a>
            <a class="chip chip-light" href="/Courses/Index?CourseGroupId=REKVAL">@Localizer["ChipRetraining"]</a>
            <a class="chip chip-light" href="/Courses/Index?Level=Beginner">@Localizer["ChipBeginner"]</a>
            <a class="chip chip-light" href="/Courses/Index?City=Praha">@Localizer["ChipPrague"]</a>
            <a class="chip chip-light" href="/Courses/Index?HasCertificate=true">@Localizer["ChipCertificate"]</a>
        </div>
    </div>
</section>

<section class="container-xl mb-4">
    <div class="trust-stripe rounded-4 p-3">
        <div class="row row-cols-2 row-cols-md-4 g-3 g-md-0 align-items-center text-center text-md-start">
            <div class="col">
                <div class="trust-item d-flex align-items-center justify-content-center justify-content-md-start gap-2">
                    <i class="bi bi-star-fill"></i>
                    <span>@Html.Raw(Localizer["TrustRating", "<span class=\"stat-number\" data-target=\"4.8\" data-decimals=\"1\" data-suffix=\"/5\">4.8</span>"])</span>
                </div>
            </div>
            <div class="col">
                <div class="trust-item d-flex align-items-center justify-content-center justify-content-md-start gap-2">
                    <i class="bi bi-people"></i>
                    <span>@Html.Raw(Localizer["TrustGraduates", "<span class=\"stat-number\" data-target=\"10000\" data-suffix=\"+\">10 000</span>"])</span>
                </div>
            </div>
            <div class="col">
                <div class="trust-item d-flex align-items-center justify-content-center justify-content-md-start gap-2">
                    <i class="bi bi-shield-check"></i>
                    <span>@Localizer["TrustGuarantee"]</span>
                </div>
            </div>
            <div class="col">
                <div class="trust-item d-flex align-items-center justify-content-center justify-content-md-start gap-2">
                    <i class="bi bi-patch-check"></i>
                    <span>@Localizer["TrustCertificate"]</span>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    (function () {
        const locale = document.documentElement.lang || 'cs';

        const restoreSelections = () => {
            const form = document.getElementById('heroForm');
            const pSel = form?.querySelector('select[name="persona"]');
            const gSel = form?.querySelector('select[name="goal"]');
            if (pSel && localStorage.persona) pSel.value = localStorage.persona;
            if (gSel && localStorage.goal) gSel.value = localStorage.goal;
            form?.addEventListener('submit', () => {
                if (pSel) localStorage.persona = pSel.value || "";
                if (gSel) localStorage.goal = gSel.value || "";
            });
        };

        const runTypewriter = () => {
            const el = document.querySelector('.typewriter');
            if (!el) return;
            const text = el.getAttribute('data-typewriter-text') || '';
            let index = 0;
            el.classList.add('is-typing');
            el.textContent = '';

            const step = () => {
                if (index <= text.length) {
                    el.textContent = text.slice(0, index);
                    index += 1;
                    window.setTimeout(step, 70);
                } else {
                    el.classList.remove('is-typing');
                    el.classList.add('typewriter-complete');
                }
            };

            step();
        };

        const animateStats = () => {
            const stats = document.querySelectorAll('.stat-number');
            if (!stats.length) return;

            stats.forEach((el) => {
                const target = Number(el.getAttribute('data-target')) || 0;
                const decimals = Number(el.getAttribute('data-decimals')) || 0;
                const duration = Number(el.getAttribute('data-duration')) || 1600;
                const prefix = el.getAttribute('data-prefix') || '';
                const suffix = el.getAttribute('data-suffix') || '';

                const startTimestamp = performance.now();

                const tick = (now) => {
                    const progress = Math.min((now - startTimestamp) / duration, 1);
                    const current = target * progress;
                    const formatted = current.toLocaleString(locale, {
                        minimumFractionDigits: decimals,
                        maximumFractionDigits: decimals
                    });
                    el.textContent = `${prefix}${formatted}${suffix}`;
                    if (progress < 1) {
                        requestAnimationFrame(tick);
                    }
                };

                requestAnimationFrame(tick);
            });
        };

        const init = () => {
            restoreSelections();
            runTypewriter();
            animateStats();
        };

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    })();
</script>

<section class="container-xl">
  <div class="row g-3 align-items-stretch">
    <div class="col-lg-8">
      <div class="feature-card h-100 p-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h2 class="h5 mb-0">@Localizer["RecommendedForYou"]</h2>
          <a class="btn btn-sm btn-outline-secondary" href="/Courses/Index">@Localizer["RecommendedViewAll"]</a>
        </div>
        <div class="row g-3">
          @foreach (var c in Model.PicksForPersona)
          {
            <div class="col-12 col-md-6">
              @await Html.PartialAsync("/Pages/Shared/Components/_CourseCard.cshtml", c)
            </div>
          }
          @if (!Model.PicksForPersona.Any())
          {
            <div class="col-12 text-muted">@Localizer["RecommendedEmpty"]</div>
          }
        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="feature-card h-100 p-3">
        <h2 class="h6">@Localizer["StartingSoon"]</h2>
        <ul class="list-unstyled small mb-3">
          @foreach (var c in Model.FastSoonest)
          {
            <li class="mb-2">
              <a asp-page="/Courses/Details" asp-route-id="@c.Id">@c.Title</a>
              <span class="text-muted">â€” @c.Date.ToString("d")</span>
            </li>
          }
        </ul>
        <a class="btn btn-outline-primary btn-sm" href="/Courses/Calendar"><i class="bi bi-calendar3"></i> @Localizer["CalendarButton"]</a>
      </div>
    </div>
  </div>

  <div class="row g-3 mt-1">
    <div class="col-12">
      <div class="feature-card p-3">
        <h2 class="h6 mb-2">@Localizer["NewsHeading"]</h2>
        <div class="d-flex flex-wrap gap-3">
          @foreach (var a in Model.FreshNews)
          {
            <a class="news-pill" asp-page="/Articles/Details" asp-route-id="@a.Id">@a.Title</a>
          }
        </div>
      </div>
    </div>
  </div>
</section>

<section class="app-section">
    <div class="container-xl">
        <h2 class="section-title text-center">@Localizer["HowItWorksTitle"]</h2>
        <div class="row g-4 text-center">
            <div class="col-md-4">
                <div class="feature-card h-100 p-4">
                    <div class="icon-circle mx-auto mb-3">
                        <i class="bi bi-journal"></i>
                    </div>
                    <h3 class="h5">@Localizer["StepSelectTitle"]</h3>
                    <p class="mb-0">@Localizer["StepSelectDescription"]</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-card h-100 p-4">
                    <div class="icon-circle mx-auto mb-3">
                        <i class="bi bi-person-check"></i>
                    </div>
                    <h3 class="h5">@Localizer["StepRegisterTitle"]</h3>
                    <p class="mb-0">@Localizer["StepRegisterDescription"]</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-card h-100 p-4">
                    <div class="icon-circle mx-auto mb-3">
                        <i class="bi bi-credit-card"></i>
                    </div>
                    <h3 class="h5">@Localizer["StepPayTitle"]</h3>
                    <p class="mb-0">@Localizer["StepPayDescription"]</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="app-section app-section-alt">
    <div class="container-xl text-center">
        <h2 class="section-title mb-3">@Localizer["WhyChooseHeading"]</h2>
        <p class="mx-auto app-section-description">@Localizer["WhyChooseDescription"]</p>
    </div>
</section>

