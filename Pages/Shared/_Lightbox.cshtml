@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer
@{
    var closeLabel = Localizer["CloseLabel"].Value ?? "Close preview";
    var imageFallbackAlt = Localizer["ImageFallbackAlt"].Value ?? "Preview image";
    var imageFallbackAltJson = System.Text.Json.JsonSerializer.Serialize(imageFallbackAlt);
}

<div x-data="{
        isOpen: false,
        title: '',
        description: '',
        imageUrl: '',
        open(payload = {}) {
            this.title = payload.title || '';
            this.description = payload.description || '';
            this.imageUrl = payload.imageUrl || '';
            this.isOpen = true;
            this.$nextTick(() => this.focusFirst());
        },
        close() {
            this.isOpen = false;
            this.title = '';
            this.description = '';
            this.imageUrl = '';
        },
        focusFirst() {
            requestAnimationFrame(() => {
                const dialog = this.$refs.dialog;
                if (!dialog) {
                    return;
                }

                const focusable = dialog.querySelector('[data-initial-focus]');
                if (focusable instanceof HTMLElement) {
                    focusable.focus({ preventScroll: true });
                }
            });
        }
    }"
     x-cloak
     x-show="isOpen"
     x-transition.opacity
     class="fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6"
     role="dialog"
     aria-modal="true"
     aria-labelledby="lightbox-title"
     x-on:keydown.escape.window="close()"
     x-on:open-lightbox.window="open($event.detail)">
    <div class="fixed inset-0 bg-black/90" aria-hidden="true" x-on:click="close()"></div>

    <div class="relative w-full max-w-3xl overflow-hidden rounded-2xl bg-gray-900 text-white shadow-2xl"
         tabindex="-1"
         x-ref="dialog">
        <button type="button"
                class="absolute top-4 right-4 inline-flex h-10 w-10 items-center justify-center rounded-full bg-white/10 text-white transition hover:bg-white/20 focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-gray-900"
                x-on:click="close()"
                data-initial-focus>
            <span class="sr-only">@closeLabel</span>
            <i class="bi bi-x-lg" aria-hidden="true"></i>
        </button>

        <template x-if="imageUrl">
            <img :src="imageUrl"
                 :alt="title || @Html.Raw(imageFallbackAltJson)"
                 class="max-h-full max-w-full w-full object-contain"
                 loading="lazy" />
        </template>

        <div class="p-6 sm:p-8">
            <h2 id="lightbox-title" class="text-xl font-semibold text-white" x-text="title"></h2>
            <p class="mt-2 text-sm text-gray-300" x-text="description"></p>
        </div>
    </div>
</div>
