@page
@model IndexModel
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer T
@{
    ViewData["Title"] = T["Title"];
}

@await Html.PartialAsync("_Hero", new HeroViewModel
    {
        Title = T["Home.Hero.Title"].Value,
        Subtitle = T["Home.Hero.Subtitle"].Value,
        PrimaryCta = T["Home.Hero.PrimaryCta"].Value,
        SecondaryCta = T["Home.Hero.SecondaryCta"].Value,
        SearchPlaceholder = T["Home.Hero.SearchPlaceholder"].Value,
        Chips = new()
        {
            T["Home.Hero.Chip.Online"].Value,
            T["Home.Hero.Chip.Retraining"].Value,
            T["Home.Hero.Chip.Certificate"].Value
        }
    })

<section class="container-xl mb-4">
    <div class="trust-stripe rounded-4 p-3">
        <div class="row row-cols-2 row-cols-md-4 g-3 g-md-0 align-items-center text-center text-md-start">
            <div class="col">
                <div class="trust-item d-flex align-items-center justify-content-center justify-content-md-start gap-2" role="status" aria-live="polite">
                    <i class="bi bi-star-fill"></i>
                    <span>@Html.Raw(T["TrustRating", "<span class=\"stat-number\" data-target=\"4.8\" data-decimals=\"1\" data-suffix=\"/5\">4.8</span>"])</span>
                </div>
            </div>
            <div class="col">
                <div class="trust-item d-flex align-items-center justify-content-center justify-content-md-start gap-2" role="status" aria-live="polite">
                    <i class="bi bi-people"></i>
                    <span>@Html.Raw(T["TrustGraduates", "<span class=\"stat-number\" data-target=\"10000\" data-suffix=\"+\">10 000</span>"])</span>
                </div>
            </div>
            <div class="col">
                <div class="trust-item d-flex align-items-center justify-content-center justify-content-md-start gap-2">
                    <i class="bi bi-shield-check"></i>
                    <span>@T["TrustGuarantee"]</span>
                </div>
            </div>
            <div class="col">
                <div class="trust-item d-flex align-items-center justify-content-center justify-content-md-start gap-2">
                    <i class="bi bi-patch-check"></i>
                    <span>@T["TrustCertificate"]</span>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    (function () {
        const locale = document.documentElement.lang || 'cs';

        const animateStats = () => {
            const stats = document.querySelectorAll('.stat-number');
            if (!stats.length) return;

            const duration = 2000;

            const startAnimation = (el) => {
                const target = Number(el.getAttribute('data-target')) || 0;
                const decimals = Number(el.getAttribute('data-decimals')) || 0;
                const prefix = el.getAttribute('data-prefix') || '';
                const suffix = el.getAttribute('data-suffix') || '';

                const startTimestamp = performance.now();

                const renderValue = (value) => {
                    const formatted = value.toLocaleString(locale, {
                        minimumFractionDigits: decimals,
                        maximumFractionDigits: decimals
                    });
                    el.textContent = `${prefix}${formatted}${suffix}`;
                };

                renderValue(0);

                const tick = (now) => {
                    const progress = Math.min((now - startTimestamp) / duration, 1);
                    const current = target * progress;
                    renderValue(current);
                    if (progress < 1) {
                        requestAnimationFrame(tick);
                    }
                };

                requestAnimationFrame(tick);
            };

            if (!('IntersectionObserver' in window)) {
                stats.forEach(startAnimation);
                return;
            }

            const observer = new IntersectionObserver((entries, obs) => {
                entries.forEach((entry) => {
                    if (!entry.isIntersecting) return;
                    startAnimation(entry.target);
                    obs.unobserve(entry.target);
                });
            }, {
                threshold: 0.4
            });

            stats.forEach((el) => observer.observe(el));
        };

        const init = () => {
            animateStats();
        };

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    })();
</script>

@await Html.PartialAsync("/Pages/Shared/_CertificationTimeline.cshtml")

@await Html.PartialAsync("/Pages/Shared/_TestimonialsCarousel.cshtml", Model.FeaturedTestimonials)

<section class="container-xl">
  <div class="row g-3 align-items-stretch">
    <div class="col-lg-8">
      <div class="feature-card h-100 p-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h2 class="h5 mb-0">@T["RecommendedForYou"]</h2>
          <a class="btn btn-sm btn-outline-secondary" href="/Courses/Index">@T["RecommendedViewAll"]</a>
        </div>
        <div class="row g-3">
          @foreach (var c in Model.PicksForPersona)
          {
            <div class="col-12 col-md-6">
              @await Html.PartialAsync("/Pages/Shared/_CourseCard.cshtml", c)
            </div>
          }
          @if (!Model.PicksForPersona.Any())
          {
            <div class="col-12 text-muted">@T["RecommendedEmpty"]</div>
          }
        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="feature-card h-100 p-3">
        <h2 class="h6">@T["StartingSoon"]</h2>
        <ul class="list-unstyled small mb-3">
          @foreach (var c in Model.FastSoonest)
          {
            <li class="mb-2">
              <a asp-page="/Courses/Details" asp-route-id="@c.Id">@c.Title</a>
              <span class="text-muted">â€” @c.Date.ToString("d")</span>
            </li>
          }
        </ul>
        <a class="btn btn-outline-primary btn-sm" href="/Courses/Calendar"><i class="bi bi-calendar3"></i> @T["CalendarButton"]</a>
      </div>
    </div>
  </div>

  <div class="row g-3 mt-1">
    <div class="col-12">
      <div class="feature-card p-3">
        <h2 class="h6 mb-2">@T["NewsHeading"]</h2>
        <div class="d-flex flex-wrap gap-3">
          @foreach (var a in Model.FreshNews)
          {
            <a class="news-pill" asp-page="/Articles/Details" asp-route-id="@a.Id">@a.Title</a>
          }
        </div>
      </div>
    </div>
  </div>
</section>

<section class="app-section">
    <div class="container-xl">
        <h2 class="section-title text-center">@T["HowItWorksTitle"]</h2>
        <div class="row g-4 text-center">
            <div class="col-md-4">
                <div class="feature-card h-100 p-4">
                    <div class="icon-circle mx-auto mb-3">
                        <i class="bi bi-clipboard-data" aria-hidden="true"></i>
                    </div>
                    <h3 class="h5">@T["StepSelectTitle"]</h3>
                    <p class="mb-0">@T["StepSelectDescription"]</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-card h-100 p-4">
                    <div class="icon-circle mx-auto mb-3">
                        <i class="bi bi-calendar-check" aria-hidden="true"></i>
                    </div>
                    <h3 class="h5">@T["StepRegisterTitle"]</h3>
                    <p class="mb-0">@T["StepRegisterDescription"]</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="feature-card h-100 p-4">
                    <div class="icon-circle mx-auto mb-3">
                        <i class="bi bi-patch-check" aria-hidden="true"></i>
                    </div>
                    <h3 class="h5">@T["StepPayTitle"]</h3>
                    <p class="mb-0">@T["StepPayDescription"]</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="app-section app-section-alt">
    <div class="container-xl text-center">
        <h2 class="section-title mb-3">@T["WhyChooseHeading"]</h2>
        <p class="mx-auto app-section-description">@T["WhyChooseDescription"]</p>
    </div>
</section>


@section Scripts {
    <script src="~/js/testimonials.js" asp-append-version="true"></script>
}
