@using Microsoft.AspNetCore.Localization
@using Microsoft.AspNetCore.Mvc.ViewFeatures
@using Microsoft.Extensions.Localization
@using SysJaky_N.Extensions
@using SysJaky_N.Resources
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer
@inject IStringLocalizer<CompanyContactResources> CompanyContact
@{
    var requestCulture = Context.Features.Get<IRequestCultureFeature>();
    var currentCulture = requestCulture?.RequestCulture.Culture.TwoLetterISOLanguageName ?? "cs";
    var currentPage = ViewContext.RouteData.Values["page"]?.ToString() ?? string.Empty;
    var canAccessAdmin = User.IsInRole("Admin");
}
<!DOCTYPE html>
<html lang="@currentCulture">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - SysJaky_N</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="~/css/design-system.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/utilities.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/components.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/components/buttons.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/components/forms.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/components/modals.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/responsive.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/output.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/dist/styles.min.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/lib/altcha/altcha.min.css" asp-append-version="true" />
    @await RenderSectionAsync("Head", required: false)
</head>
<body>
    <a href="#main-content" class="visually-hidden-focusable">@Localizer["SkipToContent"]</a>
    <header role="banner" class="site-header">
        <nav id="mainNav" class="navbar navbar-expand-lg app-navbar fixed-top" role="navigation" aria-label='@Localizer["PrimaryNavigation"]' x-data="{ mobileMenuOpen: false }" x-on:keydown.escape.window="mobileMenuOpen = false">
            <div class="container-xxl nav-inner d-flex align-items-center gap-3">
                <a class="navbar-brand d-inline-flex align-items-center gap-3" asp-area="" asp-page="/Index">
                    <span class="icon-box" aria-hidden="true"><i class="bi bi-award-fill"></i></span>
                    <span class="fw-semibold">@Localizer["BrandName"]</span>
                </a>
                <div class="primary-nav d-none d-lg-flex align-items-center ms-4 flex-grow-1">
                    <ul class="navbar-nav align-items-center gap-1 mb-0">
                        <li class="nav-item">
                            <a class="nav-link @(currentPage == "/Index" ? "active" : string.Empty)" asp-area="" asp-page="/Index" aria-current="@(currentPage == "/Index" ? "page" : null)">@Localizer["NavHome"]</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link @(currentPage == "/About" ? "active" : string.Empty)" asp-area="" asp-page="/About" aria-current="@(currentPage == "/About" ? "page" : null)">@Localizer["NavAbout"]</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link @(currentPage == "/Services" ? "active" : string.Empty)" asp-area="" asp-page="/Services" aria-current="@(currentPage == "/Services" ? "page" : null)">@Localizer["NavServices"]</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link @(currentPage == "/Courses/Index" ? "active" : string.Empty)" asp-area="" asp-page="/Courses/Index" aria-current="@(currentPage == "/Courses/Index" ? "page" : null)">@Localizer["NavCourses"]</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link @(currentPage == "/Articles/Index" ? "active" : string.Empty)" asp-area="" asp-page="/Articles/Index" aria-current="@(currentPage == "/Articles/Index" ? "page" : null)">@Localizer["NavArticles"]</a>
                        </li>
                    </ul>
                </div>
                <div class="nav-action-group d-none d-lg-flex align-items-center gap-2 ms-auto">
                    @if (canAccessAdmin)
                    {
                        <a class="btn btn-admin-highlight d-inline-flex align-items-center gap-2" asp-page="/Admin/Dashboard/Index" aria-label='@Localizer["AdminDashboard"]'>
                            <i class="bi bi-speedometer2" aria-hidden="true"></i>
                            <span>@Localizer["AdminDashboard"]</span>
                        </a>
                    }
                    <button class="btn btn-gradient-cta d-inline-flex align-items-center gap-2" data-bs-toggle="offcanvas" href="#advisor" role="button" aria-controls="advisor" aria-haspopup="dialog">
                        <i class="bi bi-magic"></i>
                        @Localizer["AdvisorButton"]
                    </button>
                    <partial name="_LanguageSwitcher" />
                    <a class="btn btn-icon" asp-area="" asp-page="/Cart" aria-label='@Localizer["CartAriaLabel"]'>
                        <i class="bi bi-cart"></i>
                        <span class="visually-hidden">@Localizer["Cart"]</span>
                    </a>
                    <button type="button" class="btn btn-outline-light d-inline-flex align-items-center justify-content-center gap-2 theme-toggle" title='@Localizer["ToggleTheme"]'>
                        <i class="bi bi-sun-fill theme-icon-light"></i>
                        <i class="bi bi-moon-fill theme-icon-dark"></i>
                    </button>
                    <partial name="_LoginPartial" view-data='new ViewDataDictionary(ViewData) { ["LoginInstance"] = "desktop" }' />
                </div>
                <button class="navbar-toggler d-lg-none ms-auto" type="button" x-on:click="mobileMenuOpen = !mobileMenuOpen" :aria-expanded="mobileMenuOpen.toString()" aria-controls="mobileNavPanel" aria-label='@Localizer["ToggleNavigation"]'>
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            <div id="mobileNavPanel" class="mobile-nav-panel d-lg-none glass-offcanvas" x-cloak x-show="mobileMenuOpen" x-transition.origin.top x-on:click.outside="mobileMenuOpen = false" :aria-hidden="(!mobileMenuOpen).toString()">
                <div class="offcanvas-header px-4 pt-4">
                    <div class="d-flex align-items-center gap-2">
                        <span class="icon-box" aria-hidden="true"><i class="bi bi-award-fill"></i></span>
                        <span class="fw-semibold">@Localizer["BrandName"]</span>
                    </div>
                    <button type="button" class="btn-close btn-close-white" x-on:click="mobileMenuOpen = false" aria-label='@Localizer["OffcanvasClose"]'></button>
                </div>
                <div class="offcanvas-body d-flex flex-column gap-4 px-4 pb-4">
                    <nav class="mobile-nav" aria-label='@Localizer["PrimaryNavigation"]'>
                        <ul class="navbar-nav flex-column gap-2">
                            <li class="nav-item">
                                <a class="nav-link @(currentPage == "/Index" ? "active" : string.Empty)" asp-area="" asp-page="/Index" aria-current="@(currentPage == "/Index" ? "page" : null)" x-on:click="mobileMenuOpen = false">@Localizer["NavHome"]</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link @(currentPage == "/About" ? "active" : string.Empty)" asp-area="" asp-page="/About" aria-current="@(currentPage == "/About" ? "page" : null)" x-on:click="mobileMenuOpen = false">@Localizer["NavAbout"]</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link @(currentPage == "/Services" ? "active" : string.Empty)" asp-area="" asp-page="/Services" aria-current="@(currentPage == "/Services" ? "page" : null)" x-on:click="mobileMenuOpen = false">@Localizer["NavServices"]</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link @(currentPage == "/Courses/Index" ? "active" : string.Empty)" asp-area="" asp-page="/Courses/Index" aria-current="@(currentPage == "/Courses/Index" ? "page" : null)" x-on:click="mobileMenuOpen = false">@Localizer["NavCourses"]</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link @(currentPage == "/Articles/Index" ? "active" : string.Empty)" asp-area="" asp-page="/Articles/Index" aria-current="@(currentPage == "/Articles/Index" ? "page" : null)" x-on:click="mobileMenuOpen = false">@Localizer["NavArticles"]</a>
                            </li>
                        </ul>
                    </nav>
                    <div class="d-grid gap-3">
                        @if (canAccessAdmin)
                        {
                            <a class="btn btn-admin-highlight w-100 d-inline-flex align-items-center justify-content-center gap-2" asp-page="/Admin/Dashboard/Index" aria-label='@Localizer["AdminDashboard"]' x-on:click="mobileMenuOpen = false">
                                <i class="bi bi-speedometer2" aria-hidden="true"></i>
                                <span>@Localizer["AdminDashboard"]</span>
                            </a>
                        }
                        <a class="btn btn-gradient-cta w-100 d-inline-flex align-items-center justify-content-center gap-2" data-bs-toggle="offcanvas" href="#advisor" role="button" aria-controls="advisor" aria-haspopup="dialog" x-on:click="mobileMenuOpen = false">
                            <i class="bi bi-magic"></i>
                            @Localizer["AdvisorButton"]
                        </a>
                        <a class="btn btn-icon w-100 justify-content-center" asp-area="" asp-page="/Cart" aria-label='@Localizer["CartAriaLabel"]' x-on:click="mobileMenuOpen = false">
                            <i class="bi bi-cart"></i>
                            <span class="ms-2">@Localizer["Cart"]</span>
                        </a>
                        <div class="language-switcher-mobile">
                            <partial name="_LanguageSwitcher" />
                        </div>
                        <button type="button" class="btn btn-outline-light d-inline-flex align-items-center justify-content-center gap-2 theme-toggle" title='@Localizer["ToggleTheme"]' x-on:click="mobileMenuOpen = false">
                            <i class="bi bi-sun-fill theme-icon-light"></i>
                            <i class="bi bi-moon-fill theme-icon-dark"></i>
                            <span class="ms-1">@Localizer["ToggleTheme"]</span>
                        </button>
                        <div class="login-mobile">
                            <partial name="_LoginPartial" view-data='new ViewDataDictionary(ViewData) { ["LoginInstance"] = "mobile" }' />
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    @{
        var appContentClasses = ViewData["AppContentClasses"] as string;
        var appContentClassList = string.IsNullOrWhiteSpace(appContentClasses)
            ? "container-xxl px-3 px-md-4"
            : appContentClasses;
    }
    <div class="app-content @appContentClassList">
        <main id="main-content" role="main" class="app-main" tabindex="-1">
            @RenderBody()
        </main>
    </div>

    <partial name="_AdvisorOffcanvas" />

    <vc:chatbot-widget />

    <footer class="site-footer" role="contentinfo">
        <div class="container-xxl py-5 position-relative">
            <div class="row gy-4 align-items-start footer-sections">
                <div class="col-12 col-lg-4">
                    <div class="d-flex flex-column gap-2">
                        <div class="d-flex align-items-center gap-2">
                            <span class="icon-box" aria-hidden="true"><i class="bi bi-award-fill"></i></span>
                            <span class="fw-semibold">@Localizer["BrandName"]</span>
                        </div>
                        <p class="text-white-75 mb-0">@Localizer["FooterCompanyName"]</p>
                        <p class="text-white-50 mb-0">@CompanyContact["Registration"]</p>
                    </div>
                </div>
                <div class="col-12 col-md-6 col-lg-4">
                    <h5 class="footer-heading">@Localizer["FooterServicesHeading"]</h5>
                    <ul class="list-unstyled footer-list mb-0">
                        <li>@Localizer["FooterServiceQualityConsulting"]</li>
                        <li>@Localizer["FooterServiceAudits"]</li>
                        <li>@Localizer["FooterServiceTraining"]</li>
                        <li>@Localizer["FooterServiceDocumentation"]</li>
                    </ul>
                </div>
                <div class="col-12 col-md-6 col-lg-4">
                    <h5 class="footer-heading">@Localizer["FooterContactHeading"]</h5>
                    <ul class="list-unstyled footer-list mb-0">
                        <li><i class="bi bi-envelope me-2"></i>@CompanyContact["Email"]</li>
                        <li><i class="bi bi-telephone me-2"></i>@CompanyContact["Phone"]</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom mt-5 pt-4">
                <p class="mb-0 text-white-50 text-center">@Localizer["FooterNotice", DateTime.Now.Year]</p>
            </div>
        </div>
    </footer>

    <div class="toast-container position-fixed top-0 end-0 p-3" x-data="{}" x-cloak aria-live="polite" aria-atomic="true" style="z-index: 1080;">
        <template x-for="toast in $store.toast.items" :key="toast.id">
            <div class="alert shadow border-0 toast-message" role="status" x-transition.opacity.duration.200ms x-transition.origin.top
                 :class="{
                    'alert-success text-dark': toast.type === 'success',
                    'alert-danger text-white': toast.type === 'error',
                    'alert-warning text-dark': toast.type === 'warning',
                    'alert-info text-dark': toast.type === 'info',
                    'alert-dark text-white': !['success', 'error', 'warning', 'info'].includes(toast.type)
                 }">
                <div class="d-flex align-items-start gap-3">
                    <div class="flex-grow-1">
                        <h6 class="fw-semibold mb-1" x-show="toast.title" x-text="toast.title"></h6>
                        <p class="mb-0" x-text="toast.message"></p>
                    </div>
                    <button type="button" class="btn-close btn-close-white" aria-label="Close notification" x-on:click="$store.toast.remove(toast.id)"></button>
                </div>
            </div>
        </template>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="~/lib/altcha/altcha.min.js" asp-append-version="true"></script>
    <script defer src="~/lib/alpine/alpine.js" asp-append-version="true"></script>
    <script type="module" src="~/js/alpine-components.js" asp-append-version="true"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="~/js/chatbot.js" asp-append-version="true"></script>

    @await RenderSectionAsync("Scripts", required: false)

    <style>body { padding-top: 5.5rem; }</style>
</body>
</html>
