@page
@model SysJaky_N.Pages.Admin.PriceSchedules.CreateModel
@{
    ViewData["Title"] = "Vytvořit cenový plán";
}

<h1>Vytvořit cenový plán</h1>

@if (Model.ConflictingSchedules.Count > 0)
{
    <div class="alert alert-warning mt-3">
        <h2 class="h5">Detekované konflikty</h2>
        <p>Nový interval se překrývá s následujícími plány. Pro rychlé vyřešení je můžete ukončit nastavením <strong>Platí do</strong> na @Model.PriceSchedule.FromUtc.ToString("g").</p>
        <ul class="mb-0">
        @foreach (var conflict in Model.ConflictingSchedules)
        {
            var fromLocal = DateTime.SpecifyKind(conflict.FromUtc, DateTimeKind.Utc).ToLocalTime();
            var toLocal = DateTime.SpecifyKind(conflict.ToUtc, DateTimeKind.Utc).ToLocalTime();
            <li>
                <strong>@conflict.Course?.Title</strong>: @fromLocal.ToString("g") – @toLocal.ToString("g")
                <a class="btn btn-sm btn-outline-warning ms-2" asp-page="Edit" asp-route-id="@conflict.Id">Upravit plán</a>
            </li>
        }
        </ul>
    </div>
}

<form method="post" class="mt-4">
    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

    <partial name="_PriceScheduleForm" model="new SysJaky_N.Pages.Admin.PriceSchedules.PriceScheduleFormModel(Model.PriceSchedule, Model.Courses)" />

    <div class="mt-4">
        <partial name="~/Pages/Shared/_FormActions.cshtml" model='new SysJaky_N.Pages.Admin.Shared.FormActionsModel { SubmitText = "Vytvořit", CancelText = "Zrušit" }' />
    </div>
</form>

@section Scripts {
    @{ await Html.RenderPartialAsync("_ValidationScriptsPartial"); }
}
