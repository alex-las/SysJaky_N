@page
@model SysJaky_N.Pages.Admin.Articles.IndexModel
@inject IStringLocalizer<SysJaky_N.Pages.Admin.Articles.IndexModel> Localizer
@{
    ViewData["Title"] = Localizer["Title"];
}

<section class="admin-page-header">
    <div class="admin-page-header__title">
        <h1>@Localizer["Header"]</h1>
    </div>
    <div class="admin-page-header__actions">
        <button type="button"
                class="btn btn-admin-primary"
                data-admin-modal-target="#adminModal"
                data-url="@Url.Page("Create")">
            @Localizer["CreateButton"]
        </button>
    </div>
</section>

<form method="get" class="admin-card" role="search" aria-label='@Localizer["FilterAriaLabel"]'>
    <div class="admin-filters">
        <div class="flex-grow-1">
            <label class="form-label visually-hidden" asp-for="SearchTitle">@Localizer["FilterSearchLabel"]</label>
            <input asp-for="SearchTitle" class="form-control" placeholder='@Localizer["FilterSearchPlaceholder"]' aria-label='@Localizer["FilterSearchLabel"]' />
        </div>
        <div>
            <label class="form-label visually-hidden" asp-for="SelectedAuthorId">@Localizer["FilterAuthorLabel"]</label>
            <select asp-for="SelectedAuthorId" asp-items="Model.AuthorOptions" class="form-select" aria-label='@Localizer["FilterAuthorLabel"]'>
                <option value="">@Localizer["FilterAuthorAllOption"]</option>
            </select>
        </div>
        <div>
            <label class="form-label" asp-for="PublicationFilter">@Localizer["FilterPublicationLabel"]</label>
            <select asp-for="PublicationFilter" asp-items="Model.PublicationOptions" class="form-select"></select>
        </div>
        <div>
            <label class="form-label" asp-for="CreatedFrom">@Localizer["FilterFromLabel"]</label>
            <input asp-for="CreatedFrom" type="date" class="form-control" />
        </div>
        <div>
            <label class="form-label" asp-for="CreatedTo">@Localizer["FilterToLabel"]</label>
            <input asp-for="CreatedTo" type="date" class="form-control" />
        </div>
    </div>
    <div class="admin-form-actions">
        <button type="submit" class="btn btn-admin-primary">@Localizer["FilterSubmit"]</button>
        <a class="btn btn-admin-ghost" asp-page="/Admin/Articles/Index">@Localizer["FilterReset"]</a>
    </div>
</form>

<div class="admin-table-wrapper table-responsive mt-4">
    <table class="table admin-table align-middle mb-0">
        <thead>
            <tr>
                <th scope="col">@Localizer["TableHeaderTitle"]</th>
                <th scope="col">@Localizer["TableHeaderAuthor"]</th>
                <th scope="col">@Localizer["TableHeaderCreated"]</th>
                <th scope="col">@Localizer["TableHeaderStatus"]</th>
                <th scope="col" class="text-end">@Localizer["TableHeaderActions"]</th>
            </tr>
        </thead>
        <tbody>
        @{ var nowUtc = Model.NowUtc; }
        @foreach (var item in Model.Articles)
        {
            var statusText = string.Empty;
            var statusClass = "bg-secondary";
            if (!item.IsPublished)
            {
                statusText = Localizer["StatusDraft"];
            }
            else if (item.PublishedAtUtc.HasValue && item.PublishedAtUtc.Value > nowUtc)
            {
                var scheduledAtLocal = DateTime.SpecifyKind(item.PublishedAtUtc.Value, DateTimeKind.Utc).ToLocalTime();
                statusText = Localizer["StatusScheduled", scheduledAtLocal.ToString("g")];
                statusClass = "bg-warning text-dark";
            }
            else
            {
                var publishedAtUtc = item.PublishedAtUtc ?? item.CreatedAt;
                var publishedAtLocal = DateTime.SpecifyKind(publishedAtUtc, DateTimeKind.Utc).ToLocalTime();
                statusText = Localizer["StatusPublished", publishedAtLocal.ToString("g")];
                statusClass = "bg-success";
            }
            <tr>
                <td>@item.Title</td>
                <td>@(item.Author?.UserName ?? item.Author?.Email ?? Localizer["UnknownAuthor"])</td>
                <td>@item.CreatedAt.ToString("g")</td>
                <td>
                    <span class="badge @statusClass">@statusText</span>
                </td>
                <td class="text-end">
                    <div class="admin-table-actions justify-content-end">
                        <button type="button"
                                class="btn btn-sm btn-admin-ghost"
                                data-admin-modal-target="#adminModal"
                                data-url="@Url.Page("Edit", new { id = item.Id })">
                            @Localizer["ActionEdit"]
                        </button>
                        <a asp-page="Details" asp-route-id="@item.Id" class="btn btn-sm btn-admin-ghost">@Localizer["ActionDetail"]</a>
                        <button type="button"
                                class="btn btn-sm btn-admin-warning"
                                data-admin-modal-target="#adminModal"
                                data-url="@Url.Page("Delete", new { id = item.Id })">
                            @Localizer["ActionDelete"]
                        </button>
                    </div>
                </td>
            </tr>
        }
        </tbody>
    </table>
</div>
