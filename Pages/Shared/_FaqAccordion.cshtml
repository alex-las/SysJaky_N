@using System.Text.Json
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer

@functions {
    private record FaqItem(int Id, string Question, string Answer);
}

@{
    var faqItemsResource = Localizer["FaqItems"];
    var faqItems = faqItemsResource.ResourceNotFound
        ? Array.Empty<FaqItem>()
        : JsonSerializer.Deserialize<FaqItem[]>(faqItemsResource.Value) ?? Array.Empty<FaqItem>();
}

<section class="py-5 bg-light">
    <div class="container">
        <div class="mx-auto max-w-3xl" x-data="{ activeItem: null }">
            <div class="text-center mb-4">
                <span class="text-primary text-uppercase fw-semibold">@Localizer["SectionBadge"]</span>
                <h2 class="h3 mt-2">@Localizer["SectionHeading"]</h2>
                <p class="text-muted mb-0">@Localizer["SectionDescription"]</p>
            </div>

            <div class="d-grid gap-3">
                @foreach (var item in faqItems)
                {
                    <article class="bg-white border rounded-3 shadow-sm" x-data="{ id: @item.Id }">
                        <button type="button"
                                class="w-100 text-start px-4 py-3 bg-transparent border-0 d-flex justify-content-between align-items-center gap-3"
                                :aria-expanded="activeItem === id"
                                x-on:click="activeItem = activeItem === id ? null : id">
                            <span class="fw-semibold">@item.Question</span>
                            <span class="badge rounded-pill"
                                  :class="activeItem === id ? 'bg-primary text-white' : 'bg-secondary-subtle text-secondary'">
                                <i class="bi" :class="activeItem === id ? 'bi-dash-lg' : 'bi-plus-lg'" aria-hidden="true"></i>
                                <span class="visually-hidden">@Localizer["ToggleLabel", item.Question]</span>
                            </span>
                        </button>
                        <div class="px-4 pb-4" x-cloak x-show="activeItem === id" x-transition.opacity x-transition.duration.300ms>
                            <p class="mb-0 text-muted">@item.Answer</p>
                        </div>
                    </article>
                }
            </div>
        </div>
    </div>
</section>
