@page "{id:int}"
@model SysJaky_N.Pages.Courses.DetailsModel

<h1>@Model.Course.Title</h1>

@if (TempData["CartError"] is string cartError && !string.IsNullOrWhiteSpace(cartError))
{
    <div class="alert alert-danger" role="alert">@cartError</div>
}

<p>@Model.Course.Description</p>
<p>Price: @Model.Course.Price.ToString("C")</p>
<p>Date: @Model.Course.Date.ToShortDateString()</p>
<p><a href="/Courses/ICS/@Model.Course.Id">Přidat do kalendáře</a></p>

@if (Model.CourseBlock != null)
{
    <h2>Part of block: @Model.CourseBlock.Title</h2>
    <p>@Model.CourseBlock.Description</p>
    <p>Block price: @Model.CourseBlock.Price</p>
    <form method="post" asp-page-handler="OrderBlock">
        <input type="hidden" name="blockId" value="@Model.CourseBlock.Id" />
        <button type="submit" class="btn btn-secondary">Order entire block</button>
    </form>
}

<form method="post">
    <button type="submit" class="btn btn-primary" aria-label="Add @Model.Course.Title to cart">Add to cart</button>
</form>

@if (User.Identity?.IsAuthenticated ?? false)
{
    <form method="post" asp-page-handler="AddToWishlist">
        <button type="submit" class="btn btn-outline-secondary">Přidat do wishlistu</button>
    </form>
}

@if (Model.Reviews.Any())
{
    <h2>Reviews</h2>
    <ul>
        @foreach (var review in Model.Reviews)
        {
            <li>
                <strong>@review.Rating/5</strong> @review.User?.UserName on @review.CreatedAt.ToShortDateString()
                <div>@review.Comment</div>
            </li>
        }
    </ul>
}

@if (User.Identity?.IsAuthenticated ?? false)
{
    <h3>Add Review</h3>
    <form method="post" asp-page-handler="Review">
        <div class="mb-3">
            <label asp-for="NewReview.Rating" class="form-label"></label>
            <input asp-for="NewReview.Rating" class="form-control" min="1" max="5" />
            <span asp-validation-for="NewReview.Rating" class="text-danger"></span>
        </div>
        <div class="mb-3">
            <label asp-for="NewReview.Comment" class="form-label"></label>
            <textarea asp-for="NewReview.Comment" class="form-control"></textarea>
            <span asp-validation-for="NewReview.Comment" class="text-danger"></span>
        </div>
        <button type="submit" class="btn btn-success">Submit</button>
    </form>
}
else
{
    <p><a asp-page="/Account/Login">Log in</a> to add a review.</p>
}

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}

